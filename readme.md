# DF Workspace

This repository contains a ROS 2 Humble workspace (`df_ws`) designed to handle conversational AI tasks using Docker containers. The system comprises three main nodes:
- **Whisper ASR Node**: Handles audio transcription.
- **Decision Maker Node**: Processes the transcription and generates a response using an LLM.
- **Google TTS Node**: Converts the response text to speech.

---

## **How to Run**

1. **Git clone the repository**
    ```bash
    git clone https://github.com/anujsainarain/df_ws.git
    ```

2. **Clone the whisper_cpp repository**:
Since we are utilizing the whisper_cpp's ability to carry out the STT operation, we need to manually add it as a submodule to the repository.

    ```bash
    cd df_ws/src/whisper_asr_node
    git clone https://github.com/ggerganov/whisper.cpp.git whisper_cpp
    rm -rf whisper_cpp/.git
    ```

3. **Build the Docker Compose Configuration**:
   ```bash
   cd ../../
   docker-compose build
   ```
     
4. **Run the docker containers**:
   ```bash
   docker-compose up
   ```

5. **Choosing the audio file**:
Once the container starts, the whisper_asr_node waits for an instruction from the topic `/audio_file` which it subscribes to to select the `.wav` file to play. To choose the file open a new terminal.

   ```bash
   docker exec -it <container_id> /bin/bash
   ```
Once you do run this, it would open the terminal inside the container. Follow this by publishing the name of the `.wav` file you would like to run.

   ```bash
   ros2 topic pub --once /audio_file std_msgs/String "data: 'Trip'"
   ```

Here, `Trip` is the audio file I have chosen out of the three options that are initially provided. One could replace trip with the pre-fed audio files or their own audio file once they have copied it into the container. These pre-fed options are : `Book`, `Food` and `Trip`. 

If you want to add other .wav files, you could do so by following the instructions given below. and then repeat the process from **step 4**.

Doing the above would spin the three nodes : `whisper_asr_node`, `decision_maker_node`, and `google_tts_node`

 - Whisper ASR Node: Transcribes the audio files. It subscribes to the topic `/audio_file` to select audio files and publishes the transcribed data to the topic `/recognized_speech`.
        Note: Use `https://www.narakeet.com/create/text-to-wav.html#trynow` to generate your own `.wav` file. Once you do that, you can either rebuild and run the `docker-compose.yaml` or follow the heading **"Add more Audio files in the container"**

 - Decision Maker Node: Processes the transcribed audio. It uses LLaMa 7B variant to implement a chatbot and has placeholders to use prompts for different LLM models. In placeholders, it uses different criterias `latency`,`sentiment_score`, and `relevance_score` to set a different persona and contraints to the LLaMa being used. You can also see the outputs generated by the LLM model in the terminal. The Node subscribes to the topic `/recognized_speech` and produces the output to the topic `/final_response`
 - Google TTS Node: Generates a synthesized audio response. It does so by subscribing to the data it receives from the topic `/final_response`, while also subscribing to `/text_to_speech`
        Note: It can be retrieved using `docker cp`.

## Add more Audio files in the container
To add more audio files in the container, run the below line in the terminal.

    docker cp ./src/whisper_asr_node/output/ <container_id>:/root/df_ws/src/whisper_asr_node/output/docker_output.wav 
    
Where, <container_id> is the Container ID of the whisper_asr_node container.
NOTE: Ensure that ther 

## Retrieve the Output
After the nodes have finished running copy the generated audio from the `google_tts_node" container to your system:

    docker cp <container_id>:/root/df_ws/src/google_tts_node/output/docker_output.wav ./src/google_tts_node/output/
Where, <container_id> is the Container ID of the google_tts_node container.


## Miscellaneous Info 

The LLM used for this Task is present at :`https://drive.google.com/file/d/1MI0UPvoyLGLO2JgPjnhIOe9PsJT7qTRu/view?usp=drive_link`.
